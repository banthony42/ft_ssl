#!/usr/bin/python
# -*- coding: utf-8 -*-
from __future__ import print_function

import subprocess
import os
import sys

OKGREEN = '\033[92m'
ENDC = '\033[0m'
FAIL = '\033[91m'

MD5 = ["./ft_ssl", "md5"]
MD5BASE = ["md5"]
SHA256 = ["./ft_ssl", "sha256"]
SHA224 = ["./ft_ssl", "sha224"]
SHA384 = ["./ft_ssl", "sha384"]
SHA512 = ["./ft_ssl", "sha512"]
SHA256BASE = ["openssl", "sha", "-sha256"]
SHA224BASE = ["openssl", "sha", "-sha224"]
SHA384BASE = ["openssl", "sha", "-sha384"]
SHA512BASE = ["openssl", "sha", "-sha512"]

ALGOS = [MD5, SHA256, SHA224, SHA384, SHA512]
BASEALGOS = [MD5BASE, SHA256BASE, SHA224BASE, SHA384BASE, SHA512BASE]

SUCCESS = 0
TOTAL = 0

COMMANDS = [
    {"command":["echo", "pickle ricker"], "options": []},
    {"command":["echo", "Do not pity the dead, Harry."], "options": ["-p"]},
    {"command":["echo", "Pity the living."], "options": ["-q", "-r"]},
    {"command":[], "options": ["file"]},
    {"command":[], "options": ["-r", "file"]},
    {"command":[], "options": ["-s", "\"pity those that aren't following baerista on spotify.\""]},
    {"command":["echo", "be sure to handle edge cases carefully"], "options": ["-p", "file"]},
    {"command":["echo", "some of this will not make sense at first"], "options": ["file"]},
    {"command":["echo", "but eventually you will understand"], "options": ["-p", "-r", "file"]},
    {"command":["echo", "GL HF let's go"], "options": ["-p", "-s", "\"foo\"", "file"]},
    {"command":["echo", "one more thing"], "options": ["-r", "-p", "-s", "\"foo\"", "file", "-s", "\"bar\""]},
    {"command":["echo", "just to be extra clear"], "options": ["-r", "-q" ,"-p", "-s", "\"foo\"", "file"]},
    {"command":[], "options": ["./test"]},
    {"command":[], "options": ["folder"]},
    {"command":["echo", "ab"], "options": ["-pq"]},
    {"command":["echo", "ab"], "options": ["-pppq"]},
    {"command":["echo", "ab"], "options": ["-q"]},
    {"command":[], "options": ["-q", "file"]}
]

COMMANDS2 = [
    {"command":["echo", "test simpe"], "options": []},
    {"command":["echo", "a"], "options": []},
    {"command":["echo", ""], "options": []},
    {"command":["echo", "\n\t"], "options": []},
]


COMMANDS3 = "1.2_.3__.4___.5____.6_____.7______.8_______.9________.10________.11_________.12__________.13___________.14____________.15_____________.16______________.17_______________.18________________.19_________________.20__________________.21___________________.22____________________.23_____________________.24______________________.25_______________________.26________________________.27_________________________.28__________________________.29___________________________.30____________________________.31_____________________________.This string has length 32,,,0000.This string has length 33,,,00000.This string has length 34,,,000000.This string has length 35,,,0000000.This string has length 36,,,00000000.This string has length 37,,,000000000.This string has length 38,,,0000000000.This string has length 39,,,00000000000.This string has length 40,,,000000000000.This string has length 41,,,0000000000000.This string has length 42,,,00000000000000.This string has length 43,,,000000000000000.This string has length 44,,,0000000000000000.This string has length 45,,,00000000000000000.This string has length 46,,,000000000000000000.This string has length 47,,,0000000000000000000.This string has length 48,,,00000000000000000000.This string has length 49,,,000000000000000000000.This string has length 50,,,0000000000000000000000.This string has length 51,,,00000000000000000000000.This string has length 52,,,000000000000000000000000.This string has length 53,,,0000000000000000000000000.This string has length 54,,,00000000000000000000000000.This string has length 55,,,000000000000000000000000000.This string has length 56,,,0000000000000000000000000000.This string has length 57,,,00000000000000000000000000000.This string has length 58,,,000000000000000000000000000000.This string has length 59,,,0000000000000000000000000000000.This string has length 60,,,00000000000000000000000000000000.This string has length 61,,,000000000000000000000000000000000.This string has length 62,,,0000000000000000000000000000000000.This string has length 63,,,00000000000000000000000000000000000.64______________________________________________________________.65_______________________________________________________________.66________________________________________________________________.67_________________________________________________________________.68__________________________________________________________________.69___________________________________________________________________.70____________________________________________________________________.71_____________________________________________________________________.72______________________________________________________________________.73_______________________________________________________________________.74________________________________________________________________________.75_________________________________________________________________________.76__________________________________________________________________________.77___________________________________________________________________________.78____________________________________________________________________________.79_____________________________________________________________________________.80______________________________________________________________________________.81_______________________________________________________________________________.82________________________________________________________________________________.83_________________________________________________________________________________.84__________________________________________________________________________________.85___________________________________________________________________________________.86____________________________________________________________________________________.87_____________________________________________________________________________________.88______________________________________________________________________________________.89_______________________________________________________________________________________.90________________________________________________________________________________________.91_________________________________________________________________________________________.92__________________________________________________________________________________________.93___________________________________________________________________________________________.94____________________________________________________________________________________________.95_____________________________________________________________________________________________.96______________________________________________________________________________________________.97_______________________________________________________________________________________________.98________________________________________________________________________________________________.99_________________________________________________________________________________________________.100_________________________________________________________________________________________________.101__________________________________________________________________________________________________.102___________________________________________________________________________________________________.103____________________________________________________________________________________________________.104_____________________________________________________________________________________________________.105______________________________________________________________________________________________________.106_______________________________________________________________________________________________________.107________________________________________________________________________________________________________.108_________________________________________________________________________________________________________.109__________________________________________________________________________________________________________.110___________________________________________________________________________________________________________.111____________________________________________________________________________________________________________.112_____________________________________________________________________________________________________________.113______________________________________________________________________________________________________________.114_______________________________________________________________________________________________________________.115________________________________________________________________________________________________________________.116_________________________________________________________________________________________________________________.117__________________________________________________________________________________________________________________.118___________________________________________________________________________________________________________________.119____________________________________________________________________________________________________________________.120_____________________________________________________________________________________________________________________.121______________________________________________________________________________________________________________________.122_______________________________________________________________________________________________________________________.123________________________________________________________________________________________________________________________.124_________________________________________________________________________________________________________________________.125__________________________________________________________________________________________________________________________.126___________________________________________________________________________________________________________________________.127____________________________________________________________________________________________________________________________.128_____________________________________________________________________________________________________________________________.129______________________________________________________________________________________________________________________________.130_______________________________________________________________________________________________________________________________.131________________________________________________________________________________________________________________________________.132_________________________________________________________________________________________________________________________________.133__________________________________________________________________________________________________________________________________.134___________________________________________________________________________________________________________________________________.135____________________________________________________________________________________________________________________________________.136_____________________________________________________________________________________________________________________________________.137______________________________________________________________________________________________________________________________________.138_______________________________________________________________________________________________________________________________________.139________________________________________________________________________________________________________________________________________.140_________________________________________________________________________________________________________________________________________.141__________________________________________________________________________________________________________________________________________.142___________________________________________________________________________________________________________________________________________.143____________________________________________________________________________________________________________________________________________.144_____________________________________________________________________________________________________________________________________________.145______________________________________________________________________________________________________________________________________________.146_______________________________________________________________________________________________________________________________________________.147________________________________________________________________________________________________________________________________________________.148_________________________________________________________________________________________________________________________________________________.149__________________________________________________________________________________________________________________________________________________.150___________________________________________________________________________________________________________________________________________________.151____________________________________________________________________________________________________________________________________________________.152_____________________________________________________________________________________________________________________________________________________.153______________________________________________________________________________________________________________________________________________________.154_______________________________________________________________________________________________________________________________________________________.155________________________________________________________________________________________________________________________________________________________.156_________________________________________________________________________________________________________________________________________________________.157__________________________________________________________________________________________________________________________________________________________.158___________________________________________________________________________________________________________________________________________________________.159____________________________________________________________________________________________________________________________________________________________.160_____________________________________________________________________________________________________________________________________________________________.161______________________________________________________________________________________________________________________________________________________________.162_______________________________________________________________________________________________________________________________________________________________.163________________________________________________________________________________________________________________________________________________________________.164_________________________________________________________________________________________________________________________________________________________________.165__________________________________________________________________________________________________________________________________________________________________.166___________________________________________________________________________________________________________________________________________________________________.167____________________________________________________________________________________________________________________________________________________________________.168_____________________________________________________________________________________________________________________________________________________________________.169______________________________________________________________________________________________________________________________________________________________________.170_______________________________________________________________________________________________________________________________________________________________________.171________________________________________________________________________________________________________________________________________________________________________.172_________________________________________________________________________________________________________________________________________________________________________.173__________________________________________________________________________________________________________________________________________________________________________.174___________________________________________________________________________________________________________________________________________________________________________.175____________________________________________________________________________________________________________________________________________________________________________.176_____________________________________________________________________________________________________________________________________________________________________________.177______________________________________________________________________________________________________________________________________________________________________________.178_______________________________________________________________________________________________________________________________________________________________________________.179________________________________________________________________________________________________________________________________________________________________________________.180_________________________________________________________________________________________________________________________________________________________________________________.181__________________________________________________________________________________________________________________________________________________________________________________.182___________________________________________________________________________________________________________________________________________________________________________________.183____________________________________________________________________________________________________________________________________________________________________________________.184_____________________________________________________________________________________________________________________________________________________________________________________.185______________________________________________________________________________________________________________________________________________________________________________________.186_______________________________________________________________________________________________________________________________________________________________________________________.187________________________________________________________________________________________________________________________________________________________________________________________.188_________________________________________________________________________________________________________________________________________________________________________________________.189__________________________________________________________________________________________________________________________________________________________________________________________.190___________________________________________________________________________________________________________________________________________________________________________________________.191____________________________________________________________________________________________________________________________________________________________________________________________.192_____________________________________________________________________________________________________________________________________________________________________________________________.193______________________________________________________________________________________________________________________________________________________________________________________________.194_______________________________________________________________________________________________________________________________________________________________________________________________.195________________________________________________________________________________________________________________________________________________________________________________________________.196_________________________________________________________________________________________________________________________________________________________________________________________________.197__________________________________________________________________________________________________________________________________________________________________________________________________.198___________________________________________________________________________________________________________________________________________________________________________________________________.199____________________________________________________________________________________________________________________________________________________________________________________________________.200_____________________________________________________________________________________________________________________________________________________________________________________________________.201______________________________________________________________________________________________________________________________________________________________________________________________________.202_______________________________________________________________________________________________________________________________________________________________________________________________________.203________________________________________________________________________________________________________________________________________________________________________________________________________.204_________________________________________________________________________________________________________________________________________________________________________________________________________.205__________________________________________________________________________________________________________________________________________________________________________________________________________.206___________________________________________________________________________________________________________________________________________________________________________________________________________.207____________________________________________________________________________________________________________________________________________________________________________________________________________.208_____________________________________________________________________________________________________________________________________________________________________________________________________________.209______________________________________________________________________________________________________________________________________________________________________________________________________________.210_______________________________________________________________________________________________________________________________________________________________________________________________________________.211________________________________________________________________________________________________________________________________________________________________________________________________________________.212_________________________________________________________________________________________________________________________________________________________________________________________________________________.213__________________________________________________________________________________________________________________________________________________________________________________________________________________.214___________________________________________________________________________________________________________________________________________________________________________________________________________________.215____________________________________________________________________________________________________________________________________________________________________________________________________________________.216_____________________________________________________________________________________________________________________________________________________________________________________________________________________.217______________________________________________________________________________________________________________________________________________________________________________________________________________________.218_______________________________________________________________________________________________________________________________________________________________________________________________________________________.219________________________________________________________________________________________________________________________________________________________________________________________________________________________.220_________________________________________________________________________________________________________________________________________________________________________________________________________________________.221__________________________________________________________________________________________________________________________________________________________________________________________________________________________.222___________________________________________________________________________________________________________________________________________________________________________________________________________________________.223____________________________________________________________________________________________________________________________________________________________________________________________________________________________.224_____________________________________________________________________________________________________________________________________________________________________________________________________________________________.225______________________________________________________________________________________________________________________________________________________________________________________________________________________________.226_______________________________________________________________________________________________________________________________________________________________________________________________________________________________.227________________________________________________________________________________________________________________________________________________________________________________________________________________________________.228_________________________________________________________________________________________________________________________________________________________________________________________________________________________________.229__________________________________________________________________________________________________________________________________________________________________________________________________________________________________.230___________________________________________________________________________________________________________________________________________________________________________________________________________________________________.231____________________________________________________________________________________________________________________________________________________________________________________________________________________________________.232_____________________________________________________________________________________________________________________________________________________________________________________________________________________________________.233______________________________________________________________________________________________________________________________________________________________________________________________________________________________________.234_______________________________________________________________________________________________________________________________________________________________________________________________________________________________________.235________________________________________________________________________________________________________________________________________________________________________________________________________________________________________.236_________________________________________________________________________________________________________________________________________________________________________________________________________________________________________.237__________________________________________________________________________________________________________________________________________________________________________________________________________________________________________.238___________________________________________________________________________________________________________________________________________________________________________________________________________________________________________.239____________________________________________________________________________________________________________________________________________________________________________________________________________________________________________.240_____________________________________________________________________________________________________________________________________________________________________________________________________________________________________________.241______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________.242_______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________.243________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________.244_________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________.245__________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________.246___________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________.247____________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________.248_____________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________.249______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________.250_______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________.251________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________.252_________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________.253__________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________.254___________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________.255____________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________.込作金連携南政育平挙活世激即逆転。東断化情教野画摂景戒保在端身。手回実化燃話政橋売録史国年由力長准必転申。摘提況索属応局際伺断任写行普波踏。氏史跡戦再条平本企前革板様熊。過去女参主戸平実無年洗正旅真周強極。出戦覧手車足連内応縄都図保住。強権定夜高尿陽参高合宝提駐高選単北正。新手問思後力暮挑録博酒帯止物。."

def check_diff(out1, out2):

    global SUCCESS
    global TOTAL

    if out1 == out2:
        print (OKGREEN + "OK" + ENDC + "\n")
        SUCCESS += 1
    else:
        print ("Expected:")
        print (out2, end='')
        print ("Found:")
        print (out1, end='')
        print (FAIL + "WRONG" + ENDC + "\n")

    TOTAL += 1

def get_output_command(command, as_input):
    print(command, as_input)
    if command:
        std_input = subprocess.Popen(command, stdout=subprocess.PIPE)
        if as_input:
            output = subprocess.check_output(as_input, stdin=std_input.stdout)
            return output
        else:
            return std_input.stdout
    else:
        return subprocess.check_output(as_input)

def print_command(command, binaire):
    print(">>> ", end='')
    if command["command"]:
        print(" ".join(command["command"]), end=' | ')
    print(" ".join(binaire + command["options"]))
    print('')

def apply_command(commands, algos, bases):
    # print(commands)
    for command in commands:
        for algo, base in zip(algos, bases):
            # print_command(command, algo)
            try:
                out1 = get_output_command(command["command"], algo + command["options"])
                out2 = get_output_command(command["command"], base + command["options"])
                check_diff(out1, out2)
            except Exception as e:
                print(e)

def main():

    os.system("norminette **/**.[ch]")
    os.system("make")
    os.system("echo -n \"And above all,\" > file")

    apply_command(COMMANDS, [ALGOS[0]], [BASEALGOS[0]])
    apply_command(COMMANDS2, ALGOS, BASEALGOS)

    test_jo = COMMANDS3.split(".")
    commands_jo = []
    for test in test_jo:
        tmp = {"command": ["echo", str(test)], "options": []}
        commands_jo.append(tmp)
    apply_command(commands_jo, ALGOS, BASEALGOS)

    global SUCCESS
    global TOTAL

    print("===FINAL===")
    print("{}/{}".format(SUCCESS, TOTAL))

if __name__=="__main__":
    main()
